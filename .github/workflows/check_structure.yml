name: Vérification de l'arborescence et des fichiers

on:
  push:
  pull_request:

jobs:
  check-structure:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Vérifier l'arborescence
        run: |
          echo "🔍 Vérification de l'arborescence du projet..."
          
          required_dirs=("site" "site/img" "site/css" "site/js" "src")
          
          for dir in "${required_dirs[@]}"; do
            if [ ! -d "$dir" ]; then
              echo "❌ Erreur : Dossier manquant -> $dir"
              exit 1
            fi
          done

          echo "✅ Arborescence correcte."

      - name: Vérifier les types de fichiers
        run: |
          echo "🔍 Vérification des fichiers..."

          declare -A allowed_extensions
          allowed_extensions=( 
            ["site"]="html php"
            ["site/img"]="png"
            ["site/css"]="css"
            ["site/js"]="js"
          )

          # Fonction pour vérifier les extensions de fichiers
          check_files() {
            local dir=$1
            local valid_exts=$2
            for file in $(find "$dir" -type f ! -name ".gitkeep"); do
              ext="${file##*.}"
              if ! echo "$valid_exts" | grep -wq "$ext"; then
                echo "❌ Erreur : Fichier non conforme trouvé -> $file"
                return 1
              fi
            done
            return 0
          }

          # Vérification des fichiers dans chaque dossier
          for dir in "${!allowed_extensions[@]}"; do
            if [ -d "$dir" ]; then
              check_files "$dir" "${allowed_extensions[$dir]}"
              if [ $? -ne 0 ]; then
                exit 1
              fi
            fi
          done

          echo "✅ Vérification des fichiers réussie."
