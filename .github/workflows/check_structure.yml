name: V√©rification de l'arborescence et des fichiers

on:
  push:
  pull_request:

jobs:
  check-structure:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: V√©rifier l'arborescence
        run: |
          echo "üîç V√©rification de l'arborescence du projet..."
          
          required_dirs=("site" "site/img" "site/css" "site/js" "src")
          
          for dir in "${required_dirs[@]}"; do
            if [ ! -d "$dir" ]; then
              echo "‚ùå Erreur : Dossier manquant -> $dir"
              exit 1
            fi
          done

          echo "‚úÖ Arborescence correcte."

      - name: V√©rifier les types de fichiers
        run: |
          echo "üîç V√©rification des fichiers..."

          declare -A allowed_extensions
          allowed_extensions=( 
            ["site"]="html php"
            ["site/img"]="png jpg"
            ["site/css"]="css"
            ["site/js"]="js"
          )

          for dir in "${!allowed_extensions[@]}"; do
            if [ -d "$dir" ]; then
              # Exclusion des fichiers .gitkeep et gestion des espaces dans les noms de fichiers
              invalid_files=$(find "$dir" -type f ! -name ".gitkeep" ! \( $(echo "${allowed_extensions[$dir]}" | sed 's/ / -o -name *./g' | sed 's/^/-name *./') \) -print 2>/dev/null)

              if [ -n "$invalid_files" ]; then
                echo "‚ùå Erreur : Fichiers non conformes trouv√©s dans $dir :"
                echo "$invalid_files"
                exit 1
              fi
            fi
          done

          echo "‚úÖ V√©rification des fichiers r√©ussie."
